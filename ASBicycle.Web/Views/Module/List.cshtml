@{
    ViewBag.Title = "管理 | NextCMS Admin";
}

<div class="fluid">
    <div class="row">
        <div class="col-md-4">
            <div class="table-toolbar">
                <div class="btn-group">
                    <a href="javascript:void(0);" class="btn blue" onclick="Create('@Url.Action("Create")')"><i class="fa fa-plus"></i> 添加</a>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="table-responsive">
    <table class="table datatable table-striped table-bordered table-hover">
        <thead>
            <tr>
                <th width="80">
                    序号
                </th>
                <th>
                    模块(菜单)名称
                </th>
                <th>
                    模块编码
                </th>
                <th>
                    上级模块
                </th>
                <th>
                    链接地址
                </th>
                <th>
                    排序
                </th>
                <th>
                    菜单
                </th>
                <th>
                    启用
                </th>
                <th>
                    操作
                </th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

@Html.Partial("Modal")

@section scripts{
    <script>
        var oTable = null;

        $(function() {
            var actionUrl = "@Url.Action("InitDataTable")?rand=" + Math.random();
            var aoColumns = [
                { "sName": "sort" },
                {
                    "sName": "Name",
                    "bSortable": false,
                    "fnRender": function(oObj) {
                        if (oObj.aData[3] != "") {
                            return "<label class='th-label'>[ " + oObj.aData[1] + " ]</label>";
                        } else {
                            return oObj.aData[1];
                        }
                    }
                },
                { "sName": "code" },
                { "sName": "parentname" },
                { "sName": "linkurl" },
                { "sName": "ordersort" },
                {
                    "sName": "ismenu",
                    "fnRender": function(oObj) {
                        var render;
                        var t = oObj.aData[oObj.aData.length - 2];
                        if (t === "1") {
                            render = '是';
                        } else {
                            render = '否';
                        }

                        return render;
                    }
                },
                {
                    "sName": "enabled",
                    "fnRender": function(oObj) {
                        var render;
                        var t = oObj.aData[oObj.aData.length - 2];
                        if (t === "1") {
                            render = '启用';
                        } else {
                            render = '禁用';
                        }

                        return render;
                    }
                },
                {
                    "sName": "action",
                    "fnRender": function(oObj) {
                        var editUrl = '@Url.Action("Edit")';
                        var deleteUrl = '@Url.Action("Delete")';
                        var setButtonUrl = '@Url.Action("SetButton")';
                        var btnArray = "";
                        if (oObj.aData[3] !== "") {
                            btnArray += "<a href=\"javascript:void(0);\" class=\"btn btn-xs green\" onclick=\"SetButton('" + setButtonUrl + "','" + oObj.aData[oObj.aData.length - 1] + "')\"><i class=\"fa fa-gears\"></i> 设置按钮</a>";
                        }
                        btnArray += " <a href=\"javascript:void(0);\" class=\"btn btn-xs purple\" onclick=\"Edit('" + editUrl + "','" + oObj.aData[oObj.aData.length - 1] + "')\"><i class=\"fa fa-edit\"></i> 编辑</a>";
                        btnArray += " <a href=\"javascript:void(0)\" class=\"btn btn-xs red\" onclick=\"TableManaged.confirmDelete(this, '" + deleteUrl + "','" + oObj.aData[oObj.aData.length - 1] + "')\"><i class=\"fa fa-times\"></i> 删除</a>";
                        return btnArray;
                        //return TableManaged.btnEdit(editUrl, oObj.aData[oObj.aData.length - 1]) + ' ' + TableManaged.btnDelete(deleteUrl);
                    }
                }
            ];

            oTable = TableManaged.init($(".datatable"), actionUrl, aoColumns);
        });

        //新增
        function Create(actionUrl) {
            ShowModal(actionUrl, {}, "新增角色");
        }

        //编辑
        function Edit(actionUrl, id) {
            var param = { id: id };
            ShowModal(actionUrl, param, "编辑角色");
        }

        //设置按钮
        function SetButton(actionUrl, id) {
            var param = { Id: id }
            ShowModal(actionUrl, param, "设置按钮");
        }

        //保存
        function Save() {
            SaveModal(oTable);
        }
    </script>
}
